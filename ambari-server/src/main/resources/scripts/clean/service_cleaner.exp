#!/usr/bin/expect

set host      [ lindex $argv 0 ]
set user      [ lindex $argv 1 ]
set password  [ lindex $argv 2 ]
set timeout -1

spawn ssh -A -o StrictHostKeyChecking=no -o GSSAPIAuthentication=no ${user}@${host}
expect {
        "*password:*" {send "${password}\r"}
        "$*" {send "\r"}
        "#*" {send "\r"}
}
expect {
        "$*" {send "sudo -s \r"}
        "#*" {send "\r"}
}
expect {
        "$*" {
        	send "python /usr/lib/python2.6/site-packages/ambari_agent/AmbariCleaner.py > /var/log/ambari-agent/clean.log 2>&1 \r"
            expect "$*"
            send "\r"
        }
        "#*" {
        	send "python /usr/lib/python2.6/site-packages/ambari_agent/AmbariCleaner.py > /var/log/ambari-agent/clean.log 2>&1 \r"
            expect "#*"
            send "\r"
        }
}
exit